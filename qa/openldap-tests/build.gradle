apply plugin: 'elasticsearch.standalone-test'
apply plugin: 'elasticsearch.vagrantsupport'

dependencies {
    testCompile project(path: ':x-pack-elasticsearch:plugin:core', configuration: 'runtime')
    testCompile project(path: ':x-pack-elasticsearch:plugin:security', configuration: 'testArtifacts')
    testCompile project(path: ':x-pack-elasticsearch:plugin:core', configuration: 'testArtifacts')
}

processTestResources {
    if (project.rootProject.vagrantSupported) {
        dependsOn "openLdapFixture"
    }
}

sourceSets {
    test {
        resources {
            srcDirs += project(":x-pack-elasticsearch:test:idp-fixture").file("src/main/resources/provision/generated")
        }
    }
}

task openLdapFixture {
    dependsOn "vagrantCheckVersion", "virtualboxCheckVersion", ":x-pack-elasticsearch:test:idp-fixture:up"
}

if (project.rootProject.vagrantSupported) {
  test.dependsOn openLdapFixture
  test.finalizedBy ":x-pack-elasticsearch:test:idp-fixture:halt"
} else {
  test.enabled = false
}

namingConventions {
    // integ tests use Tests instead of IT
    skipIntegTestInDisguise = true
}
