Project idpFixtureProject = xpackProject("test:idp-fixture")
evaluationDependsOn(idpFixtureProject.path)

apply plugin: 'elasticsearch.standalone-test'
apply plugin: 'elasticsearch.vagrantsupport'

dependencies {
    testCompile project(path: xpackModule('core'), configuration: 'runtime')
    testCompile project(path: xpackModule('security'), configuration: 'testArtifacts')
    testCompile project(path: xpackModule('core'), configuration: 'testArtifacts')
}

processTestResources {
    if (project.rootProject.vagrantSupported) {
        dependsOn "openLdapFixture"
    }
}

sourceSets {
    test {
        resources {
            srcDirs += idpFixtureProject.file("src/main/resources/provision/generated")
        }
    }
}

task openLdapFixture {
    dependsOn "vagrantCheckVersion", "virtualboxCheckVersion", idpFixtureProject.up
}

if (project.rootProject.vagrantSupported) {
  test.dependsOn openLdapFixture
  test.finalizedBy idpFixtureProject.halt
} else {
  test.enabled = false
}

namingConventions {
    // integ tests use Tests instead of IT
    skipIntegTestInDisguise = true
}
