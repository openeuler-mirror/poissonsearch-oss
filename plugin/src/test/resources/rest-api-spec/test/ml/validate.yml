---
"Test valid job config":
  - do:
      xpack.ml.validate:
        body:  >
          {
            "analysis_config": {
              "bucket_span": "1h",
              "detectors": [{"function": "metric", "field_name": "responsetime", "by_field_name": "airline"}]
            },
            "data_description": {
              "format": "delimited",
              "field_delimiter": ",",
              "time_field": "time",
              "time_format": "yyyy-MM-dd HH:mm:ssX"
            }
          }
  - match: { acknowledged: true }

---
"Test invalid job config":
  - do:
      catch: /.data_description. failed to parse field .format./
      xpack.ml.validate:
        body:  >
          {
            "analysis_config": {
              "bucket_span": "1h",
              "detectors": [{"function": "metric", "field_name": "responsetime", "by_field_name": "airline"}]
            },
            "data_description": {
              "format": "wrong",
              "field_delimiter": ",",
              "time_field": "time",
              "time_format": "yyyy-MM-dd HH:mm:ssX"
            }
          }

---
"Test valid job config with job ID":
  - do:
      xpack.ml.validate:
        body:  >
          {
            "job_id": "validate-job-config-with-job-id",
            "analysis_config": {
              "bucket_span": "1h",
              "detectors": [{"function": "metric", "field_name": "responsetime", "by_field_name": "airline"}]
            },
            "data_description": {
              "format": "delimited",
              "field_delimiter": ",",
              "time_field": "time",
              "time_format": "yyyy-MM-dd HH:mm:ssX"
            }
          }
  - match: { acknowledged: true }

---
"Test job config that is invalid only because of the job ID":
  - do:
      catch: /Invalid job_id; '_' can contain lowercase alphanumeric \(a-z and 0-9\), hyphens or underscores; must start and end with alphanumeric/
      xpack.ml.validate:
        body:  >
          {
            "job_id": "_",
            "analysis_config": {
              "bucket_span": "1h",
              "detectors": [{"function": "metric", "field_name": "responsetime", "by_field_name": "airline"}]
            },
            "data_description": {
              "format": "delimited",
              "field_delimiter": ",",
              "time_field": "time",
              "time_format": "yyyy-MM-dd HH:mm:ssX"
            }
          }
