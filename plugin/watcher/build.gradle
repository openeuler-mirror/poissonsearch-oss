apply plugin: 'elasticsearch.build'

archivesBaseName = 'x-pack-watcher'

// TODO: enable this once we have tests
test.enabled=false
licenseHeaders.enabled = false

dependencyLicenses {
    mapping from: /owasp-java-html-sanitizer.*/, to: 'owasp-java-html-sanitizer'
    ignoreSha 'x-pack-common'
}

dependencies {
    provided "org.elasticsearch:elasticsearch:${version}"

    compile "org.elasticsearch:x-pack-common:${version}"

    // watcher deps
    compile 'com.googlecode.owasp-java-html-sanitizer:owasp-java-html-sanitizer:r239'
    compile 'com.google.guava:guava:16.0.1' // needed by watcher for the html sanitizer and security tests for jimfs
    compile 'com.sun.mail:javax.mail:1.5.6'
    // HACK: java 9 removed javax.activation from the default modules, so instead of trying to add modules, which would have
    // to be conditionalized for java 8/9, we pull in the classes directly
    compile 'javax.activation:activation:1.1.1'

}

parent.bundlePlugin {
    from jar
}

// classes are missing, e.g. com.ibm.icu.lang.UCharacter
thirdPartyAudit.excludes = [
    // uses internal java api: sun.misc.Unsafe
    'com.google.common.cache.Striped64',
    'com.google.common.cache.Striped64$1',
    'com.google.common.cache.Striped64$Cell',
    'com.google.common.primitives.UnsignedBytes$LexicographicalComparatorHolder$UnsafeComparator',
    'com.google.common.primitives.UnsignedBytes$LexicographicalComparatorHolder$UnsafeComparator$1',

    // pulled in as external dependency to work on java 9
    'com.sun.activation.registries.LineTokenizer',
    'com.sun.activation.registries.LogSupport',
    'com.sun.activation.registries.MailcapFile',
    'com.sun.activation.registries.MailcapTokenizer',
    'com.sun.activation.registries.MimeTypeEntry',
    'com.sun.activation.registries.MimeTypeFile',
    'javax.activation.MailcapCommandMap',
    'javax.activation.MimetypesFileTypeMap',
]

// pulled in as external dependency to work on java 9
if (JavaVersion.current() <= JavaVersion.VERSION_1_8) {
    thirdPartyAudit.excludes += [
        'com.sun.activation.registries.MailcapParseException',
        'javax.activation.ActivationDataFlavor',
        'javax.activation.CommandInfo',
        'javax.activation.CommandMap',
        'javax.activation.CommandObject',
        'javax.activation.DataContentHandler',
        'javax.activation.DataContentHandlerFactory',
        'javax.activation.DataHandler$1',
        'javax.activation.DataHandler',
        'javax.activation.DataHandlerDataSource',
        'javax.activation.DataSource',
        'javax.activation.DataSourceDataContentHandler',
        'javax.activation.FileDataSource',
        'javax.activation.FileTypeMap',
        'javax.activation.MimeType',
        'javax.activation.MimeTypeParameterList',
        'javax.activation.MimeTypeParseException',
        'javax.activation.ObjectDataContentHandler',
        'javax.activation.SecuritySupport$1',
        'javax.activation.SecuritySupport$2',
        'javax.activation.SecuritySupport$3',
        'javax.activation.SecuritySupport$4',
        'javax.activation.SecuritySupport$5',
        'javax.activation.SecuritySupport',
        'javax.activation.URLDataSource',
        'javax.activation.UnsupportedDataTypeException'
    ]
}
