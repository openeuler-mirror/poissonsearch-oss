---
"Test enrich crud apis":

  - do:
      enrich.put_policy:
        name: policy-crud
        body:
          match:
            indices: ["bar*"]
            match_field: baz
            enrich_fields: ["a", "b"]
  - is_true: acknowledged

  - do:
      enrich.execute_policy:
        name: policy-crud
  - is_true: acknowledged

  - do:
      enrich.get_policy:
        name: policy-crud
  - length: { policies: 1 }
  - match: { policies.0.match.name: policy-crud }
  - match: { policies.0.match.indices: ["bar*"] }
  - match: { policies.0.match.match_field: baz }
  - match: { policies.0.match.enrich_fields: ["a", "b"] }

  - do:
      enrich.get_policy: {}
  - length: { policies: 1 }
  - match: { policies.0.match.name: policy-crud }
  - match: { policies.0.match.indices: ["bar*"] }
  - match: { policies.0.match.match_field: baz }
  - match: { policies.0.match.enrich_fields: ["a", "b"] }

  - do:
      enrich.delete_policy:
        name: policy-crud
  - is_true: acknowledged
