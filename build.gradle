apply plugin: 'elasticsearch.project-attachment'

allprojects {
  apply plugin: 'idea'
  apply plugin: 'eclipse'
}

subprojects {
  group = 'org.elasticsearch'
  version = org.elasticsearch.gradle.VersionProperties.elasticsearch
}

if (hasProperty('projectsPrefix') == false) {
  allprojects {
    project.ext['projectsPrefix'] = ''
  }
}

        <repository>
            <id>elasticsearch-releases</id>
            <url>http://maven.elasticsearch.org/releases</url>
            <releases>
                <enabled>true</enabled>
                <updatePolicy>daily</updatePolicy>
            </releases>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
        <repository>
            <id>elasticsearch-internal-snapshots</id>
            <url>http://maven.elasticsearch.org/artifactory/internal-snapshots</url>
            <releases>
                <enabled>false</enabled>
            </releases>
            <snapshots>
                <enabled>true</enabled>
                <updatePolicy>always</updatePolicy>
            </snapshots>
        </repository>
*/

/*
subprojects {
  task artifacts {
    group = "Help"
    description = "Displays the artifacts associated with each configuration of " + project
    doFirst {
      configurations.findAll().each { config ->
        println "${config}:"
        config.allArtifacts.getFiles().each { file -> println "" + file}
        println ' '
      }
    }
  }
}
*/

// ================= Local Elasticsearch attachment ===============
if (hasProperty('attachments') && 'elasticsearch' in attachments) {
  subprojects {
    configurations {
      all {
        resolutionStrategy {
          dependencySubstitution {
            substitute module("org.elasticsearch:rest-api-spec:${version}") with project(":elasticsearch:rest-api-spec")
            substitute module("org.elasticsearch:elasticsearch:${version}") with project(":elasticsearch:core")
            substitute module("org.elasticsearch:test-framework:${version}") with project(":elasticsearch:test-framework")
            substitute module("org.elasticsearch.distribution.zip:elasticsearch:${version}") with project(":elasticsearch:distribution:zip")
            substitute module("org.elasticsearch.distribution.tar:elasticsearch:${version}") with project(":elasticsearch:distribution:tar")
          }
        }
      }
    }
  }
}
