---
"Test put role api":
  - skip:
      features: headers

  - do:
      cluster.health:
          wait_for_status: yellow

  - do:
      shield.put_role:
        rolename: "admin_role"
        body:  >
            {
              "name": "admin_role",
              "cluster": ["all"],
              "indices": [
                {
                  "names": "*",
                  "privileges": ["all"]
                }
              ]
            }
  - match: { role: { created: true } }

  - do:
      shield.put_user:
        username: "joe"
        body:  >
            {
              "username": "joe",
              "password": "s3krit",
              "roles" : [ "admin_role" ]
            }
  - match: { user: { created: true } }

# test that the role actually works
  - do:
      headers:
        Authorization: "Basic am9lOnMza3JpdA=="
      cluster.health: {}
  - match: { timed_out: false }

  - do:
      shield.get_role:
        rolename: "admin_role"
  - match: { found: true }
  - match: { roles.0.name: "admin_role" }
  - match: { roles.0.cluster.0:  "all" }
  - match: { roles.0.indices.0.names.0: "*" }
  - match: { roles.0.indices.0.privileges.0:  "all" }
